<script src="//codecloud.cdn.speedyrails.net/sites/5438407c6e6f64462d020000/92b82a88144a6207ab1a5e8e0f63d3d1/craftmap.js"></script>
<div class="content_container main_container position_relative">
    <a href="#" class="locate_store hidden_phone">Locate store <i class="fa fa-search"></i></a>
    <div class="stores_table">
        <ul id="store_list_container_map">
            <script id="store_list_template_map" type="x-tmpl-mustache/text">
                <li><a href="#" store_id="store_{{id}}" onclick="return show_pin(this)">{{name}}</a><li>
            </script>
        </ul>
    </div>
    <div class="map_container">
        <div id="map" class="hidden_phone">
            <img alt="map" id="map_image" src=""/>
        </div>
    </div>
    <h2 class="stores_main_heading">Directory</h2>
    <p class="store_main_desc">explore • enjoy • shop</p>
    <div class="mobile_padding show_phone">
        <a href="/map" class="mobile_dd">Open Center Map</a>
    </div>
    <div class="row">
        <div class="col-sm-12">
        
            <div id="accordion" role="tablist" aria-multiselectable="true">
                <div class="card center_container">
                    <div class="card-header" role="tab" id="headingOne">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                            <h5 class="center_name">
                                East Market
                                <i class="fa fa-angle-down pull-right" aria-hidden="true"></i>    
                            </h5>
                        </a>
                    </div>
                    <div id="collapseOne" class="collapse in" role="tabpanel" aria-labelledby="headingOne">
                        <div class="card-block">
                            <div class="store_container">
                                <div class="store_list" id="east_market_container"></div>        
                            </div>
                        </div>
                        <hr>
                    </div>
                </div>
                <div class="card center_container">
                    <div class="card-header" role="tab" id="headingTwo">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="true" aria-controls="collapseTwo">
                            <h5 class="center_name">
                                Fair Lakes Center
                                <i class="fa fa-angle-down pull-right" aria-hidden="true"></i>    
                            </h5>
                        </a>
                    </div>
                    <div id="collapseTwo" class="collapse" role="tabpanel" aria-labelledby="headingTwo">
                        <div class="card-block">
                            <div class="store_container">
                                <div class="store_list" id="fair_lakes_center_container"></div>       
                            </div>
                        </div>
                        <hr>
                    </div>
                </div>
                <div class="card center_container">
                    <div class="card-header" role="tab" id="headingThree">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">
                            <h5 class="center_name">
                                Fair Lakes Shops
                                <i class="fa fa-angle-down pull-right" aria-hidden="true"></i>    
                            </h5>
                        </a>
                    </div>
                    <div id="collapseThree" class="collapse" role="tabpanel" aria-labelledby="headingThree">
                        <div class="card-block">
                            <div class="store_container">
                                <div class="store_list" id="fair_lakes_shops_container"></div>             
                            </div>
                        </div>
                        <hr>
                    </div>
                </div>
                <div class="card center_container">
                    <div class="card-header" role="tab" id="headingFour">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseFour" aria-expanded="true" aria-controls="collapseFour">
                            <h5 class="center_name">
                                Hotels & Residences
                                <i class="fa fa-angle-down pull-right" aria-hidden="true"></i>    
                            </h5>
                        </a>
                    </div>
                    <div id="collapseFour" class="collapse" role="tabpanel" aria-labelledby="headingFour">
                        <div class="card-block">
                            <div class="store_container">
                                <div class="store_list" id="hotel_container"></div>            
                            </div>
                        </div>
                        <hr>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script id="numbered_store_list_template" type="x-tmpl-mustache/text">
    <div class="store_list_content cats_row" data-cat="{{cat_list}}">
        <p class="store_name"><a href="/stores/{{slug}}">{{name}}</a></p>
    </div>
</script>
                        
<script id="store_list_template" type="x-tmpl-mustache/text">
    <div class="store_list_content cats_row" data-cat="{{cat_list}}">
        
        <p class="store_name"><a href="/stores/{{slug}}">{{name}}</a></p>
    </div>
</script>

<script>
    $(document).ready(function(e){
        init(e);
        function renderAll (){
            var stores = getStoresList(); 
            renderStoreList('#store_list_container','#store_list_template', stores, "A", "L");
            renderStoreList('#store_list_container2','#store_list_template', stores, "M", "Z");
            renderStoreList('#store_list_container_map','#store_list_template_map', stores, "A", "Z");
            renderStoreList('#numbered_store_list_container','#numbered_store_list_template', stores,"#", "#" );
            
            var east_market = getStoresListByCategoryID(913).sortBy(function(o){ return o.name });
            console.log(east_market)
            renderStoreList('#east_market_container','#store_list_template', east_market, "A", "Z");

            var fair_lakes_center = getStoresListByCategoryID(933).sortBy(function(o){ return o.name });
            renderStoreList('#fair_lakes_center_container','#store_list_template', fair_lakes_center, "A", "Z");

            var fair_lakes_shops = getStoresListByCategoryID(956).sortBy(function(o){ return o.name });
            renderStoreList('#fair_lakes_shops_container','#store_list_template', fair_lakes_shops, "A", "Z");

            var hotels = getStoresListByCategoryID(958).sortBy(function(o){ return o.name });
            renderStoreList('#hotels_container','#store_list_template', hotels, "A", "Z");
            
            var categories = getStoreCategories();
            var category_list = [];
            $.each( categories, function( key, val ){
                if (val.store_ids != null) {
                    category_list.push(val);
                } 
            });
            renderGeneral('#category_container', '#category_template', category_list);
            renderGeneral('#mobile_cat_list', '#category_template2', category_list);
            $('#mobile_cat_list').prepend('<option value="all" selected >All Categories</option>');
            
            show_cat_stores();
            
            var coming_soon_stores = getComingSoonList();
            var new_stores = getNewStoresList();
            if (new_stores.length > 0){
                renderGeneral("#new_store_container","#new_store_template", new_stores);
            } else {
                $('#new_stores').hide();
            }
            if (coming_soon_stores.length > 0){
                renderGeneral("#coming_soon_container","#coming_soon_template", coming_soon_stores);
            } else {
                $('#coming_soon_stores').hide();
            }
            
            show_content();
            
            $.each(stores, function(i, val){
                x = val.x_coordinate - 19;
                y = val.y_coordinate - 58;
                $('#map_image').after('<div class="marker" id="store_' + val.id  + '" data-coords="' + x + ', ' + y + '" style="display:none">' + val.name + '</div>')
            });  

            $("#map_image").attr("src", getPNGMapURL());
            $('#map').craftmap({
    			image: {
    				width: 1690,
    				height: 800,
    			},
    			map: {
    				position: 'center'
    			}
    		});
        }
        
		loadMallDataCached(renderAll); 
    })
</script>